# Changelog 004 — Phase 02: Refund & Support System

> **Date:** 2026-02-13
> **Commits:** 14
> **Range:** 845a7ff...a955ada

## What Changed

Built the complete refund request and support ticket system from scratch. New backend models, endpoints, admin management pages, user-facing UIs, email notifications, and Razorpay refund integration. Delivered in 2 waves: Wave 1 (backend + admin), Wave 2 (user-facing UI).

## Changes

### Backend — Refund System

#### RefundRequest Model & User Endpoints
- **Type:** Feature
- **What:** New `RefundRequest` model with status workflow (pending → approved → processing → processed/failed), evidence uploads, admin response field. User endpoints: create, list, view refund requests
- **Why:** No refund mechanism existed. Customers had no way to request money back
- **Files:** `models/refundRequestModel.js`, `controllers/refundController.js`, `routes/refundRoutes.js`

#### Admin Refund Management
- **Type:** Feature
- **What:** Admin endpoints to list all refunds, approve (triggers Razorpay refund API), or reject with mandatory reason. Webhook handler for Razorpay refund status updates
- **Why:** Admins needed to review and process refund requests
- **Files:** `controllers/adminDashboardController.js`, `routes/adminRoutes.js`

#### Refund Notifications
- **Type:** Feature
- **What:** Email + push + in-app notifications sent to users when refund is approved or rejected
- **Why:** Users need to know the outcome of their refund request
- **Files:** `utils/email.js`, `utils/notificationService.js`

### Backend — Support Ticket System

#### SupportTicket Model & User Endpoints
- **Type:** Feature
- **What:** New `SupportTicket` model with auto-generated ticket numbers (TKT-xxx), 6 categories (booking/payment/refund/technical/account/other), 4 priority levels, status workflow (open → in_progress → resolved → closed), message threads. User endpoints: create ticket, list own tickets, view details, add messages
- **Why:** No support system existed. Users had no way to get help
- **Files:** `models/supportTicketModel.js`, `controllers/supportController.js`, `routes/supportRoutes.js`

#### Admin Support Ticket Management
- **Type:** Feature
- **What:** Admin endpoints to list all tickets with filters (status, category, priority, search), respond to tickets (public replies + internal notes), update ticket status. Email notification to user on admin response
- **Why:** Admins needed to manage and respond to support requests
- **Files:** `controllers/adminDashboardController.js`, `routes/adminRoutes.js`

### Frontend — Admin

#### Admin Refunds Page
- **Type:** Feature
- **What:** New `AdminRefunds.jsx` page with filtering by status, date range, search. Approve/reject modals with mandatory reason for rejection. Refund stats dashboard
- **Files:** `src/pages/admin/AdminRefunds.jsx`, `src/App.jsx`

#### Admin Support Page
- **Type:** Feature
- **What:** New `AdminSupport.jsx` page with ticket list, filters, message thread view, reply form (public + internal notes), status management
- **Files:** `src/pages/admin/AdminSupport.jsx`

### Frontend — User-Facing

#### Refund Request UI in OrderHistoryTab
- **Type:** Feature
- **What:** "Request Refund" button on eligible bookings in order history. Modal with reason selection, evidence upload, amount input. Refund status tracking in order details
- **Why:** Customers needed a way to request refunds from within their order history
- **Files:** `src/components/profile/tabs/OrderHistoryTab.jsx`

#### Help/Support Tab Redesign
- **Type:** Feature
- **What:** Complete redesign of HelpSupportTab for both artisan and user dashboards. Category quick-pick buttons (instead of dropdown), priority selection, ticket tracking with status badges, message thread view, better empty states
- **Why:** Previous help tab was a basic stub with no actual functionality
- **Files:** `src/components/profile/tabs/HelpSupportTab.jsx`

### Documentation

#### Phase Planning & Verification
- **Type:** Documentation
- **What:** Research docs, individual plans for all 6 sub-tasks, gap analysis, and phase completion verification
- **Files:** `.planning/` phase-02 documents

## Impact

| Area | Change |
|------|--------|
| Customer | Can request refunds, create support tickets, track status of both |
| Artisan | Can create support tickets for platform issues |
| Admin | Full refund workflow (approve/reject/auto-process), support ticket management with internal notes |
| Developer | 2 new models, clean separation of admin and user endpoints |
