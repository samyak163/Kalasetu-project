# Phase 11: Remaining Integrations & Global Polish â€” Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Comprehensive design-system sweep of all 19 remaining hardcoded-color files, plus infrastructure fixes (404 page, error boundaries, Suspense fallback) and feature wiring (MyClientsTab buttons).

**Architecture:** Layer-by-layer approach â€” infrastructure first (error handling, 404, Suspense), then concentric layers outward through notifications, auth pages, onboarding/modals, dashboards, admin, and remaining components. Each layer is independently testable.

**Tech Stack:** React 18 (JSX), Tailwind CSS with design tokens (`brand-500`, `error-500`, etc.), Lucide React icons, existing design system components (`Button`, `Card`, `Input`, `Alert`, `Avatar`, `Badge`, `EmptyState`, `BottomSheet`, `Skeleton`, `LoadingState`, `Spinner`, `StatusBadge`, `StarRating`, `FilterChips`, `MultiImageUpload`).

**No test suite exists** â€” verification is via `npm run build` + `npm run lint` + grep for `#A55233`.

**Reference:** Design doc at `docs/plans/2026-02-21-phase-11-design.md`

---

## Layer 1: Infrastructure (Tasks 1-3)

### Task 1: Create NotFoundPage

**Files:**
- Create: `kalasetu-frontend/src/pages/NotFoundPage.jsx`
- Modify: `kalasetu-frontend/src/App.jsx:72-194` (add catch-all route)

**Step 1: Create the NotFoundPage component**

Create `kalasetu-frontend/src/pages/NotFoundPage.jsx`:

```jsx
import { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { Search, Home, ArrowLeft } from 'lucide-react';
import { Button } from '../components/ui';

const CATEGORIES = ['Mehendi', 'Pottery', 'Weaving', 'Jewelry', 'Painting', 'Woodwork'];

export default function NotFoundPage() {
  const [query, setQuery] = useState('');
  const navigate = useNavigate();

  const handleSearch = (e) => {
    e.preventDefault();
    if (query.trim()) navigate(`/search?q=${encodeURIComponent(query.trim())}`);
  };

  return (
    <div className="min-h-[60vh] flex items-center justify-center px-4 py-16">
      <div className="max-w-lg w-full text-center space-y-8">
        {/* CSS Illustration */}
        <div className="relative mx-auto w-40 h-40">
          <div className="absolute inset-0 rounded-full bg-brand-50" />
          <div className="absolute top-6 left-8 w-24 h-24 rounded-full bg-brand-100 flex items-center justify-center">
            <span className="text-5xl font-bold text-brand-300">404</span>
          </div>
          <div className="absolute -bottom-1 -right-1 w-12 h-12 rounded-full bg-brand-200" />
        </div>

        <div>
          <h1 className="text-2xl font-bold text-gray-900">Page not found</h1>
          <p className="mt-2 text-gray-600">
            The page you're looking for doesn't exist or has been moved.
          </p>
        </div>

        {/* Search */}
        <form onSubmit={handleSearch} className="flex gap-2 max-w-sm mx-auto">
          <div className="relative flex-1">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
            <input
              type="text"
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              placeholder="Try searching instead..."
              className="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent"
            />
          </div>
          <Button type="submit" variant="primary" size="sm">Search</Button>
        </form>

        {/* Category Links */}
        <div>
          <p className="text-sm text-gray-500 mb-3">Popular categories</p>
          <div className="flex flex-wrap justify-center gap-2">
            {CATEGORIES.map((cat) => (
              <Link
                key={cat}
                to={`/search?q=${encodeURIComponent(cat)}`}
                className="px-3 py-1.5 text-sm font-medium text-brand-600 bg-brand-50 rounded-full hover:bg-brand-100 transition-colors"
              >
                {cat}
              </Link>
            ))}
          </div>
        </div>

        {/* Navigation */}
        <div className="flex justify-center gap-4">
          <Button variant="primary" onClick={() => navigate('/')}>
            <Home className="h-4 w-4 mr-2" />
            Go Home
          </Button>
          <Button variant="secondary" onClick={() => navigate(-1)}>
            <ArrowLeft className="h-4 w-4 mr-2" />
            Go Back
          </Button>
        </div>
      </div>
    </div>
  );
}
```

**Step 2: Add catch-all route to App.jsx**

In `kalasetu-frontend/src/App.jsx`, add the lazy import near the other page imports (around line 67):

```jsx
const NotFoundPage = lazy(() => import('./pages/NotFoundPage'));
```

Add the catch-all route as the LAST child inside the Layout route (before line 194, after the `</Route>` that closes the dashboard routes):

```jsx
        {/* 404 Catch-All */}
        <Route path="*" element={<NotFoundPage />} />
```

**Step 3: Build check**

Run: `cd kalasetu-frontend && npm run build`
Expected: Build succeeds with no errors.

**Step 4: Commit**

```bash
git add kalasetu-frontend/src/pages/NotFoundPage.jsx kalasetu-frontend/src/App.jsx
git commit -m "feat: add NotFoundPage with search and category links"
```

---

### Task 2: Upgrade Error Boundaries + ErrorFallback

**Files:**
- Modify: `kalasetu-frontend/src/components/ErrorFallback.jsx`
- Modify: `kalasetu-frontend/src/components/Layout.jsx`

**Step 1: Upgrade ErrorFallback**

Rewrite `kalasetu-frontend/src/components/ErrorFallback.jsx`:

- Replace raw SVG X icon with Lucide `AlertTriangle`
- Hide error details behind `import.meta.env.DEV` check
- Add recovery suggestions

```jsx
import { AlertTriangle } from 'lucide-react';

export default function ErrorFallback({ error, resetError }) {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 px-4">
      <div className="max-w-md w-full bg-white shadow-card rounded-card p-6 text-center">
        <div className="flex items-center justify-center w-12 h-12 mx-auto bg-error-50 rounded-full">
          <AlertTriangle className="w-6 h-6 text-error-600" />
        </div>
        <h3 className="mt-4 text-lg font-semibold text-gray-900 font-display">
          Something went wrong
        </h3>
        <p className="mt-2 text-sm text-gray-600">
          We've been notified and are working on a fix. Try refreshing the page or going back to the homepage.
        </p>
        {import.meta.env.DEV && error && (
          <div className="mt-4 p-3 bg-gray-50 rounded text-xs text-gray-700 font-mono overflow-auto max-h-32 text-left">
            {error.toString()}
          </div>
        )}
        <div className="mt-6 flex gap-3">
          <button
            onClick={resetError}
            className="flex-1 px-4 py-2 bg-brand-500 text-white rounded-button hover:bg-brand-600 btn-press"
          >
            Try again
          </button>
          <button
            onClick={() => (window.location.href = '/')}
            className="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-button hover:bg-gray-300 btn-press"
          >
            Go home
          </button>
        </div>
      </div>
    </div>
  );
}
```

**Step 2: Add layout-level ErrorBoundary to Layout.jsx**

Modify `kalasetu-frontend/src/components/Layout.jsx` to wrap `<Outlet />` in an ErrorBoundary:

```jsx
import { Outlet } from 'react-router-dom';
import Header from './Header.jsx';
import Footer from './Footer.jsx';
import ProfileModal from './profile/ProfileModal.jsx';
import ErrorBoundary from './ErrorBoundary.jsx';

const Layout = () => {
  return (
    <div className="bg-white dark:bg-gray-900 font-sans transition-colors">
      <a href="#main-content" className="sr-only focus:not-sr-only focus:absolute focus:z-50 focus:p-4 focus:bg-brand-500 focus:text-white focus:rounded-md focus:m-2">Skip to main content</a>
      <Header />
      <main id="main-content">
        <ErrorBoundary>
          <Outlet />
        </ErrorBoundary>
      </main>
      <Footer />
      <ProfileModal />
    </div>
  );
};

export default Layout;
```

**Step 3: Build check**

Run: `cd kalasetu-frontend && npm run build`

**Step 4: Commit**

```bash
git add kalasetu-frontend/src/components/ErrorFallback.jsx kalasetu-frontend/src/components/Layout.jsx
git commit -m "fix: upgrade ErrorFallback and add layout-level error boundary"
```

---

### Task 3: Upgrade Suspense Fallback

**Files:**
- Modify: `kalasetu-frontend/src/App.jsx:71`

**Step 1: Replace plain-text Suspense fallback**

In `kalasetu-frontend/src/App.jsx`, change line 71 from:

```jsx
<Suspense fallback={<div className="p-8 text-center text-sm text-gray-600">Loading...</div>}>
```

To (import LoadingState at top of file):

```jsx
import { LoadingState } from './components/ui';
```

```jsx
<Suspense fallback={<LoadingState />}>
```

**Step 2: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/App.jsx
git commit -m "fix: replace plain-text Suspense fallback with LoadingState component"
```

---

## Layer 2: Notification Components (Task 4)

### Task 4: Rebuild NotificationPanel + NotificationPrompt

**Files:**
- Modify: `kalasetu-frontend/src/components/NotificationPanel.jsx` (full rewrite)
- Modify: `kalasetu-frontend/src/components/NotificationPrompt.jsx` (full rewrite)

**Step 1: Rebuild NotificationPanel**

Rewrite `kalasetu-frontend/src/components/NotificationPanel.jsx`:

- Replace all `#A55233` and `[#A55233]` with brand tokens
- Replace raw SVG icons with Lucide `X`, `Bell`, `Check`
- Replace inline styles with design system components (`Button`, `Badge`, `Avatar`)
- Use `EmptyState` for empty notifications
- Keep existing props interface: `{ isOpen, onClose, notifications, unreadCount, onMarkRead }`

Key replacements:
- `text-[#A55233]` â†’ `text-brand-500`
- `bg-[#A55233]/10` â†’ `bg-brand-50`
- Raw SVG close â†’ `<X className="w-5 h-5" />`
- Raw SVG bell â†’ `<Bell className="w-4 h-4" />`
- Unread dot `<span className="w-2 h-2 bg-blue-500 ...">` â†’ `<span className="w-2 h-2 bg-brand-500 ...">`

**Step 2: Rebuild NotificationPrompt**

Rewrite `kalasetu-frontend/src/components/NotificationPrompt.jsx`:

- Replace raw SVG bell â†’ Lucide `Bell`
- Replace raw SVG close â†’ Lucide `X`
- Replace `bg-blue-600` â†’ `bg-brand-500`
- Replace `bg-blue-100` â†’ `bg-brand-50`, `text-blue-600` â†’ `text-brand-500`
- Use `Button variant="primary" size="sm"` for Enable
- Use `Button variant="ghost" size="sm"` for "Not now"
- Keep localStorage dismiss logic and 5s delay

**Step 3: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/components/NotificationPanel.jsx kalasetu-frontend/src/components/NotificationPrompt.jsx
git commit -m "feat: rebuild NotificationPanel and NotificationPrompt with design system"
```

---

## Layer 3: Auth Pages (Tasks 5-7) â€” PARALLELIZABLE

> Tasks 5, 6, and 7 are independent and can run in parallel via agent team.

### Task 5: Rebuild Login Pages (LoginPage + UserLoginPage)

**Files:**
- Modify: `kalasetu-frontend/src/pages/LoginPage.jsx` (full rewrite, 134 lines)
- Modify: `kalasetu-frontend/src/pages/UserLoginPage.jsx` (full rewrite, ~134 lines)

**Shared pattern for both files:**

Imports to add:
```jsx
import { Eye, EyeOff } from 'lucide-react';
import { Button, Card, Input, Alert } from '../components/ui';
```

Key changes:
- `text-[#A55233]` on brand name â†’ `text-brand-500`
- `<div className="bg-white py-8 px-6 shadow-xl rounded-2xl border border-gray-100">` â†’ `<Card className="py-8 px-6">`
- All `<input className="...focus:ring-[#A55233]...">` â†’ `<Input />` component
- Raw SVG eye icons â†’ `<Eye className="w-5 h-5" />` / `<EyeOff className="w-5 h-5" />`
- Error div `<div className="bg-red-50 border border-red-200...">` â†’ `<Alert variant="error">{error}</Alert>`
- Submit button `bg-[#A55233]...hover:bg-[#8e462b]` â†’ `<Button variant="primary" className="w-full" disabled={loading}>`
- Link colors `text-[#A55233] hover:text-[#8e462b]` â†’ `text-brand-500 hover:text-brand-600`
- `focus:ring-[#A55233]` â†’ `focus:ring-brand-500`

**Differences between the two files:**
- `LoginPage.jsx`: uses `artisanLogin`, redirects to `/artisan/dashboard/account`, subtitle "Sign in to your artisan account"
- `UserLoginPage.jsx`: uses `userLogin`, redirects to `/`, subtitle "Sign in to your account"

Preserve all business logic â€” only change the JSX/styling.

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/pages/LoginPage.jsx kalasetu-frontend/src/pages/UserLoginPage.jsx
git commit -m "feat: rebuild LoginPage and UserLoginPage with design system"
```

---

### Task 6: Rebuild Register Pages (RegisterPage + UserRegisterPage)

**Files:**
- Modify: `kalasetu-frontend/src/pages/RegisterPage.jsx` (269 lines)
- Modify: `kalasetu-frontend/src/pages/UserRegisterPage.jsx` (239 lines)

**Same import pattern as login pages** plus these specific changes:

- Auth method toggle (`bg-[#A55233] text-white` / `bg-gray-200`) â†’ `Button variant="primary"` / `Button variant="secondary"` (or styled toggle using `bg-brand-500 text-white` / `bg-gray-200`)
- All `focus:ring-[#A55233]` on inputs â†’ `Input` component
- Error div â†’ `Alert variant="error"`
- Submit button â†’ `Button variant="primary" className="w-full"`
- Brand name â†’ `text-brand-500`
- Link colors â†’ `text-brand-500 hover:text-brand-600`

**Differences:**
- `RegisterPage.jsx`: uses raw `axios.post` to `/api/auth/register`, PostHog tracking, artisan-specific copy
- `UserRegisterPage.jsx`: uses `userRegister` from auth context, simpler flow, user-specific copy

Preserve all business logic (PostHog, Sentry, toast, notification refresh).

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/pages/RegisterPage.jsx kalasetu-frontend/src/pages/UserRegisterPage.jsx
git commit -m "feat: rebuild RegisterPage and UserRegisterPage with design system"
```

---

### Task 7: Rebuild Selector Pages (AuthSelector + RegisterSelector)

**Files:**
- Modify: `kalasetu-frontend/src/pages/AuthSelector.jsx` (37 lines)
- Modify: `kalasetu-frontend/src/pages/RegisterSelector.jsx` (37 lines)

**Changes for both:**

Imports:
```jsx
import { User, Palette } from 'lucide-react';
import { Card } from '../components/ui';
```

- Replace emoji `ðŸ‘¤` â†’ `<User className="w-10 h-10 text-brand-500" />`
- Replace emoji `ðŸ”§` â†’ `<Palette className="w-10 h-10 text-brand-500" />`
- Wrap each Link card in `Card hover` or use existing Card with hover effect
- `text-[#A55233]` â†’ `text-brand-500`
- Keep grid layout, links, and copy

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/pages/AuthSelector.jsx kalasetu-frontend/src/pages/RegisterSelector.jsx
git commit -m "feat: rebuild AuthSelector and RegisterSelector with design system"
```

---

## Layer 4: Onboarding + Profile + Modals (Tasks 8-12) â€” PARALLELIZABLE

> Tasks 8-12 are independent and can run in parallel.

### Task 8: Rebuild ArtisanOnboarding

**Files:**
- Modify: `kalasetu-frontend/src/pages/ArtisanOnboarding.jsx` (659 lines â€” largest file)

**Key changes:**

Imports to add:
```jsx
import { Check } from 'lucide-react';
import { Button, Card, Input, Alert } from '../components/ui';
```

1. **Delete `const BRAND = '#A55233';`** (line 7) â€” replace ALL usages:
   - `style={{ backgroundColor: BRAND }}` â†’ `className="bg-brand-500"` (step circles, buttons, day toggles)
   - `style={{ color: BRAND }}` â†’ `className="text-brand-500"` (step labels, section headers)
   - `style={{ backgroundColor: BRAND, opacity: 0.7 }}` â†’ `className="bg-brand-400"` (completed steps)
   - `style={{ backgroundColor: s.num < step ? BRAND : '#e5e7eb' }}` â†’ `className={s.num < step ? 'bg-brand-400' : 'bg-gray-200'}`
2. **All `<input>` and `<textarea>`** â†’ `<Input />` component (remove inline `focus:ring-2` and `--tw-ring-color`)
3. **All `<select>`** â†’ styled select with `focus:ring-brand-500`
4. **Step card** `<div className="bg-white rounded-xl shadow-md p-6">` â†’ `<Card className="p-6">`
5. **Navigation buttons:**
   - Back â†’ `<Button variant="secondary">`
   - Next â†’ `<Button variant="primary">`
   - Publish â†’ `<Button variant="primary">`
6. **Published success screen:**
   - Replace `&#10024;&#127881;&#10024;` emoji with Lucide `Check` in brand circle
   - Replace `style={{ backgroundColor: BRAND }}` Link â†’ `<Button variant="primary" as={Link} to="...">`
7. **Day toggle buttons** (line 436-448): `style={active ? { backgroundColor: BRAND } : undefined}` â†’ `className={active ? 'bg-brand-500 text-white border-transparent' : 'bg-white text-gray-600 border-gray-300'}`
8. **Review step section headers** (lines 540, 554, 573, 591): `style={{ color: BRAND }}` â†’ `className="text-brand-500"`

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/pages/ArtisanOnboarding.jsx
git commit -m "feat: rebuild ArtisanOnboarding with design system"
```

---

### Task 9: Rebuild ProfileDropdown

**Files:**
- Modify: `kalasetu-frontend/src/components/common/ProfileDropdown.jsx` (191 lines)

**Changes:**

Imports to add:
```jsx
import { ChevronDown, User, Settings, HelpCircle, LogOut } from 'lucide-react';
import { Avatar } from '../components/ui';
```

1. **Avatar fallback** (lines 68-86 and 108-126): Replace raw `<div className="bg-[#A55233] text-white ...">` with `<Avatar name={displayName} src={avatarUrl} size="md" />` (check Avatar component API)
2. **Chevron** (lines 90-96): Replace raw SVG â†’ `<ChevronDown className={...} />`
3. **Focus ring** (line 63): `focus:ring-[#A55233]` â†’ `focus:ring-brand-500`
4. **Menu items** (lines 137-157): Add icons before text:
   - "View Profile" â†’ `<User className="w-4 h-4 mr-2" />`
   - "Settings" â†’ `<Settings className="w-4 h-4 mr-2" />`
   - "Help & Support" â†’ `<HelpCircle className="w-4 h-4 mr-2" />`
5. **Sign Out** (lines 165-171): Add icon `<LogOut className="w-4 h-4 mr-2" />`, ensure `text-red-600` â†’ `text-error-600`

**Important:** Keep `handleOpenProfileTab` logic and `open-profile` custom event dispatch intact.

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/components/common/ProfileDropdown.jsx
git commit -m "feat: rebuild ProfileDropdown with design system"
```

---

### Task 10: Rebuild HowItWorks

**Files:**
- Modify: `kalasetu-frontend/src/components/HowItWorks.jsx` (31 lines)

**Changes:**

Imports to add:
```jsx
import { Search, MessageCircle, Star } from 'lucide-react';
```

1. Replace `bg-[#F5F5F5]` â†’ `bg-gray-50`
2. Replace `text-[#1A1A1A]` â†’ `text-gray-900`
3. Replace `bg-[#A55233]` circles â†’ `bg-brand-500`
4. Replace `<FindIcon />`, `<ConnectIcon />`, `<ReviewIcon />` â†’ `<Search className="w-6 h-6" />`, `<MessageCircle className="w-6 h-6" />`, `<Star className="w-6 h-6" />`
5. Remove `import { FindIcon, ConnectIcon, ReviewIcon } from './Icons.jsx';`

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/components/HowItWorks.jsx
git commit -m "feat: rebuild HowItWorks with design system and Lucide icons"
```

---

### Task 11: Rebuild HowItWorksModal

**Files:**
- Modify: `kalasetu-frontend/src/components/HowItWorksModal.jsx` (126 lines)

**Changes:**

Imports:
```jsx
import { X } from 'lucide-react';
import { Button } from './ui';
```

1. Close button SVG â†’ `<X className="w-6 h-6" />`
2. Step circles `bg-[#A55233]` â†’ `bg-brand-500`
3. "Got It!" button `bg-[#A55233]...hover:bg-[#8e462b]` â†’ `<Button variant="primary" className="w-full" onClick={onClose}>Got It!</Button>`

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/components/HowItWorksModal.jsx
git commit -m "feat: rebuild HowItWorksModal with design system"
```

---

### Task 12: Rebuild ArtisanInfoModal

**Files:**
- Modify: `kalasetu-frontend/src/components/ArtisanInfoModal.jsx` (90 lines)

**Changes:**

Imports:
```jsx
import { X, Check } from 'lucide-react';
import { Button } from './ui';
```

1. Close SVG â†’ `<X className="w-6 h-6" />`
2. `<span className="text-green-600 font-bold">âœ“</span>` â†’ `<Check className="w-5 h-5 text-success-500 flex-shrink-0" />`
3. "Get Started" button `bg-[#A55233]...hover:bg-[#8e462b]` â†’ `<Button variant="primary" className="flex-1">`
4. "Maybe Later" button â†’ `<Button variant="secondary">`

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/components/ArtisanInfoModal.jsx
git commit -m "feat: rebuild ArtisanInfoModal with design system"
```

---

## Layer 5: Dashboard + Data (Tasks 13-15)

### Task 13: Rebuild UserDashboard

**Files:**
- Modify: `kalasetu-frontend/src/pages/dashboard/user/UserDashboard.jsx` (47 lines)

**Changes:**

Imports:
```jsx
import { LayoutDashboard, CalendarCheck, CreditCard, Settings, HelpCircle, User } from 'lucide-react';
import { Card } from '../../../components/ui';
```

1. NavLink active class: `bg-[#A55233]/10 text-[#A55233]` â†’ `bg-brand-50 text-brand-600`
2. Add icons to each nav item (inline with text)
3. Wrap sidebar `<div className="sticky top-24...">` in `<Card className="p-2">` (or just update colors)

Nav item icons mapping:
- Dashboard â†’ `LayoutDashboard`
- My Bookings â†’ `CalendarCheck`
- Payments â†’ `CreditCard`
- Preferences â†’ `Settings`
- Support â†’ `HelpCircle`
- View My Profile â†’ `User`

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/pages/dashboard/user/UserDashboard.jsx
git commit -m "feat: rebuild UserDashboard sidebar with design system"
```

---

### Task 14: Rebuild UserPayments

**Files:**
- Modify: `kalasetu-frontend/src/pages/dashboard/user/UserPayments.jsx` (141 lines)

**Changes:**

Imports:
```jsx
import { Printer, CreditCard as CreditCardIcon } from 'lucide-react';
import { Card, Badge, Button, Skeleton, EmptyState, BottomSheet } from '../../../components/ui';
```

1. **Status colors map** (lines 5-12): Replace raw Tailwind color classes with `Badge` component using variant mapping:
   - `captured` â†’ `<Badge status="completed">captured</Badge>`
   - `failed` â†’ `<Badge status="cancelled">failed</Badge>`
   - `pending` â†’ `<Badge status="pending">pending</Badge>`
   - `refunded` â†’ `<Badge status="pending">refunded</Badge>` (or create info variant)
2. **Payment cards** (line 68): `<div className="bg-white border...">` â†’ `<Card>`
3. **Loading skeleton** (lines 48-54): Replace raw pulse divs â†’ `<Skeleton />` components
4. **Empty state** (lines 60-64): â†’ `<EmptyState icon={<CreditCardIcon />} title="No payments yet" description="..." />`
5. **"Details" link** (line 101-103): `text-[#A55233]` â†’ `<Button variant="ghost" size="sm">`
6. **"Print Receipt"** (line 124-128): `text-[#A55233]` â†’ `<Button variant="ghost" size="sm"><Printer className="w-3.5 h-3.5 mr-1" />Print Receipt</Button>`
7. **Refund button**: Keep `text-red-600` â†’ `text-error-600`
8. **`window.confirm()`** for refund â†’ Replace with `BottomSheet` confirmation (add state `showRefundSheet`/`refundPaymentId`, render BottomSheet with confirm/cancel buttons)

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/pages/dashboard/user/UserPayments.jsx
git commit -m "feat: rebuild UserPayments with design system and BottomSheet refund"
```

---

### Task 15: Wire MyClientsTab Action Buttons

**Files:**
- Modify: `kalasetu-frontend/src/components/profile/tabs/MyClientsTab.jsx:136-142`

**Changes:**

Add `useNavigate` import (if not already present):
```jsx
import { useNavigate } from 'react-router-dom';
```

Add at top of component:
```jsx
const navigate = useNavigate();
```

Wire the three buttons (around lines 136-142):

```jsx
<div className="flex gap-2 pt-4 border-t border-gray-100">
  <Button
    variant="primary"
    size="sm"
    onClick={() => navigate('/artisan/dashboard/account#bookings')}
  >
    View History
  </Button>
  {(client.phoneNumber || client.phone) && (
    <Button
      variant="secondary"
      size="sm"
      onClick={() => window.open(`tel:${client.phoneNumber || client.phone}`)}
    >
      Call
    </Button>
  )}
  <Button
    variant="secondary"
    size="sm"
    onClick={() => navigate(`/messages?userId=${client._id || client.id}`)}
  >
    Message
  </Button>
</div>
```

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/components/profile/tabs/MyClientsTab.jsx
git commit -m "feat: wire MyClientsTab action buttons (history, call, message)"
```

---

## Layer 6: Admin Pages (Tasks 16-17) â€” PARALLELIZABLE

### Task 16: Upgrade AdminDashboard

**Files:**
- Modify: `kalasetu-frontend/src/pages/admin/AdminDashboard.jsx` (228 lines)

**Changes:**

Imports to add:
```jsx
import { Card, Alert, Button, LoadingState } from '../../components/ui';
```

1. **COLORS array** (line 74): `['#A55233', '#D88A6A', '#E9AF96', '#6E3520', '#F3D1C2']` â†’ Use CSS custom properties or keep as chart-specific brand palette (Recharts needs hex values â€” this is acceptable, but document them as chart-only constants)
2. **Loading state** (lines 32-38): Raw spinner div â†’ `<LoadingState />`
3. **Error state** (lines 40-56): Raw red div â†’ `<Alert variant="error">{error}<Button onClick={fetchStats} variant="primary" size="sm" className="mt-4">Retry</Button></Alert>`
4. **Stat cards** (wrapping divs): Wrap in `<Card>` component
5. **Period selector**: Style as `<Button variant="secondary" size="sm">` group

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/pages/admin/AdminDashboard.jsx
git commit -m "feat: upgrade AdminDashboard with design system components"
```

---

### Task 17: Upgrade AdminAnalytics

**Files:**
- Modify: `kalasetu-frontend/src/pages/admin/AdminAnalytics.jsx` (435 lines)

**Changes:**

Imports to add:
```jsx
import { Card, EmptyState, Skeleton } from '../../components/ui';
```

1. **STATUS_COLORS** (lines 16-23): Replace raw Tailwind colors with semantic tokens:
   - `'bg-green-500'` â†’ `'bg-success-500'`
   - `'bg-blue-500'` â†’ `'bg-info-500'`
   - `'bg-yellow-400'` â†’ `'bg-warning-400'`
   - `'bg-red-500'` â†’ `'bg-error-500'`
   - `'bg-purple-500'` â†’ keep as-is (no semantic equivalent)
2. **StatCard** (lines 31-42): Wrap in `<Card>` instead of raw `<div className="bg-white p-5 rounded-xl shadow-sm border">`
3. **SkeletonCard** (lines 72-80): Replace raw pulse divs with `<Skeleton />` component or `<Card><Skeleton /></Card>`
4. **SectionError** (lines 44-49): Replace with `<EmptyState icon={<AlertCircle />} title="No data available" />`
5. Keep `VerticalBars` as-is (clean CSS chart, no changes needed)

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/pages/admin/AdminAnalytics.jsx
git commit -m "feat: upgrade AdminAnalytics with semantic tokens and design system"
```

---

## Layer 7: Remaining Files (Tasks 18-20)

### Task 18: Rebuild FeaturedArtisans

**Files:**
- Modify: `kalasetu-frontend/src/components/home/FeaturedArtisans.jsx` (192 lines)

**Changes:**

Imports:
```jsx
import { ArrowRight, BadgeCheck } from 'lucide-react';
import { Avatar, Skeleton, Button } from '../ui';
```

1. **Profile photo fallback** (lines 96-107): Replace `<div style={{ background: 'linear-gradient(135deg, #A55233, #C97B5D)' }}>` with `<Avatar name={artisan.fullName} size="xl" className="w-full h-48" />` â€” or use brand gradient via Tailwind: `bg-gradient-to-br from-brand-500 to-brand-300`
2. **Verified badge** (lines 115-135): Replace raw SVG checkmark â†’ `<BadgeCheck className="w-4 h-4 text-success-500" />`
3. **Star emoji** (line 152): `&#11088;` â†’ keep simple yellow star or use `<Star className="w-4 h-4 text-yellow-500 fill-current" />`
4. **SkeletonCard** (lines 5-14): Replace with design system `<Skeleton />`
5. **"View All" arrow SVG** (lines 172-178): â†’ `<ArrowRight className="w-4 h-4" />`
6. **"View All" button** (lines 166-186): â†’ `<Button variant="secondary"><span>View All Artisans</span><ArrowRight className="w-4 h-4" /></Button>`

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/components/home/FeaturedArtisans.jsx
git commit -m "feat: rebuild FeaturedArtisans with design system"
```

---

### Task 19: Rebuild NearbyArtisans

**Files:**
- Modify: `kalasetu-frontend/src/components/Maps/NearbyArtisans.jsx` (230 lines)

**Changes:**

Imports:
```jsx
import { ArrowRight, BadgeCheck, MapPin } from 'lucide-react';
import { Avatar, Alert, EmptyState, Button } from '../ui';
```

1. **Profile fallback** (lines 146-156): Same as FeaturedArtisans â€” replace `linear-gradient(135deg, #A55233, #C97B5D)` with `bg-gradient-to-br from-brand-500 to-brand-300` or `<Avatar />`
2. **Verified badge** (lines 164-179): â†’ `<BadgeCheck className="w-4 h-4 text-success-500" />`
3. **Star emoji** (line 196): same as FeaturedArtisans
4. **Error state** (lines 87-95): Raw red div â†’ `<Alert variant="error">{error}</Alert>`
5. **Empty state** (lines 97-116): Raw div with SVG â†’ `<EmptyState icon={<MapPin />} title="No artisans found nearby" description="Check back later or try searching by category." />`
6. **Loading skeletons** (lines 65-84): Replace raw pulse divs
7. **"View All" arrow** (lines 222-223): â†’ `<ArrowRight className="w-4 h-4" />`

**Step: Build check + commit**

```bash
cd kalasetu-frontend && npm run build
git add kalasetu-frontend/src/components/Maps/NearbyArtisans.jsx
git commit -m "feat: rebuild NearbyArtisans with design system"
```

---

### Task 20: Fix env.config.js Brand Color

**Files:**
- Modify: `kalasetu-frontend/src/config/env.config.js:42`

**Change:**

Line 42 is the Razorpay theme color â€” this is passed to the Razorpay checkout SDK which needs a hex value. This is NOT a Tailwind class, so we can't use a token directly.

**Options:**
1. Keep as-is and add a comment explaining why it's hex (Razorpay SDK requirement)
2. Extract to a shared `BRAND_HEX` constant

**Recommended:** Add a comment and keep the hex value since Razorpay SDK requires it:

```js
  theme: {
    color: '#A55233', // Brand hex â€” required by Razorpay SDK (cannot use CSS token)
  },
```

This ensures it won't show up as a false positive in the verification grep. Actually, it WILL show up. To avoid that, we can define it once:

```js
// Brand color hex â€” Razorpay SDK requires a hex string, not a CSS token
const BRAND_HEX = '#A5' + '5233';
```

Or simply accept this one as a documented exception. **Recommendation:** Document the exception in a comment. The grep check should exclude `env.config.js`.

**Step: Add comment + commit**

```bash
git add kalasetu-frontend/src/config/env.config.js
git commit -m "docs: document Razorpay brand color hex as SDK requirement"
```

---

## Final Verification (Task 21)

### Task 21: Verification Sweep

**Step 1: Grep for remaining hardcoded colors**

```bash
cd kalasetu-frontend && grep -r "#A55233" src/ --include="*.jsx" --include="*.js" -l
```

Expected: Only `src/config/env.config.js` (documented Razorpay SDK exception).

**Step 2: Build check**

```bash
npm run build
```

Expected: Build succeeds.

**Step 3: Lint check**

```bash
npm run lint
```

Expected: No new warnings/errors.

**Step 4: Commit verification**

```bash
git log --oneline -25
```

Verify all Phase 11 commits are present.

**Step 5: Update handover**

Update `docs/development/HANDOVER.md` with Phase 11 completion status.

---

## Execution Strategy

### Parallelization Map

```
Layer 1 (sequential): Task 1 â†’ Task 2 â†’ Task 3
Layer 2 (sequential): Task 4
Layer 3 (PARALLEL):   Task 5 | Task 6 | Task 7
Layer 4 (PARALLEL):   Task 8 | Task 9 | Task 10 | Task 11 | Task 12
Layer 5 (sequential): Task 13 â†’ Task 14 â†’ Task 15
Layer 6 (PARALLEL):   Task 16 | Task 17
Layer 7 (PARALLEL):   Task 18 | Task 19 | Task 20
Final:                Task 21
```

### File Count Summary

| Layer | Files Modified | Files Created | New Lines (est.) |
|-------|---------------|---------------|-----------------|
| 1. Infrastructure | 3 | 1 | ~80 |
| 2. Notifications | 2 | 0 | ~0 (rewrites) |
| 3. Auth Pages | 6 | 0 | ~0 (rewrites) |
| 4. Onboarding+Modals | 5 | 0 | ~0 (rewrites) |
| 5. Dashboards | 3 | 0 | ~20 |
| 6. Admin | 2 | 0 | ~0 (upgrades) |
| 7. Remaining | 3 | 0 | ~0 (upgrades) |
| **Total** | **24** | **1** | **~100** |

---

*Plan created: 2026-02-21*
*Plan by: Claude Code (writing-plans skill)*
