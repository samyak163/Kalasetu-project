# TASK: Fix XSS Vulnerability in SearchResults

## Priority: CRITICAL (Security)

## Problem
SearchResults.jsx uses `dangerouslySetInnerHTML` to render Algolia search highlights without sanitizing the HTML. This allows XSS (Cross-Site Scripting) attacks.

## File to Fix
`kalasetu-frontend/src/pages/SearchResults.jsx`

## Vulnerable Code (around lines 91-107)
```jsx
// This renders HTML from Algolia without sanitization
<span dangerouslySetInnerHTML={{ __html: hit._highlightResult?.fullName?.value }} />
```

## The Risk
If someone creates an artisan profile with malicious content like:
```
Name: <script>alert('hacked')</script>John
```
The script would execute when search results are displayed.

## Solution

### Step 1: Install DOMPurify
```bash
cd kalasetu-frontend
npm install dompurify
```

### Step 2: Create a sanitize utility
Create file: `kalasetu-frontend/src/utils/sanitize.js`
```jsx
import DOMPurify from 'dompurify';

/**
 * Sanitize HTML string to prevent XSS attacks
 * Only allows basic formatting tags used by Algolia highlights
 */
export function sanitizeHtml(dirty) {
  if (!dirty) return '';

  return DOMPurify.sanitize(dirty, {
    ALLOWED_TAGS: ['em', 'mark', 'strong', 'b', 'i'], // Only highlight tags
    ALLOWED_ATTR: ['class'], // Only class attributes
  });
}

/**
 * Safely render highlighted search result
 */
export function getHighlightedText(highlightResult, fallback = '') {
  if (!highlightResult?.value) return fallback;
  return sanitizeHtml(highlightResult.value);
}
```

### Step 3: Update SearchResults.jsx

Find all instances of `dangerouslySetInnerHTML` and wrap with sanitize:

```jsx
// At the top of the file, add import:
import { sanitizeHtml, getHighlightedText } from '../utils/sanitize';

// Replace unsafe usage:
// BEFORE (unsafe):
<span dangerouslySetInnerHTML={{ __html: hit._highlightResult?.fullName?.value }} />

// AFTER (safe):
<span dangerouslySetInnerHTML={{ __html: getHighlightedText(hit._highlightResult?.fullName, hit.fullName) }} />
```

### Step 4: Find all occurrences

Search for `dangerouslySetInnerHTML` in SearchResults.jsx and update each one:
- fullName highlights
- bio highlights
- skills highlights
- Any other highlighted fields

## Testing

After fix, try searching for artisans and verify:
1. Search highlights still work (matched text is highlighted)
2. Try creating an artisan with `<script>alert('test')</script>` in name - should NOT execute

## Success Criteria
- No XSS vulnerability
- Search highlights still display correctly
- No console errors

## Related Files
- `kalasetu-frontend/src/pages/SearchResults.jsx` - Main file to fix
- `kalasetu-frontend/src/components/ArtisanSearch.jsx` - Check for similar issues
