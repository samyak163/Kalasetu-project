---
phase: 02-refund-support
plan: 06
type: execute
wave: 4
depends_on: ["02-02", "02-04"]
gap_closure: true
files_modified:
  - kalasetu-frontend/src/components/profile/tabs/HelpSupportTab.jsx
autonomous: true

must_haves:
  truths:
    - "Help tab shows quick-pick category cards instead of a blank form"
    - "Each category pre-fills the support form with relevant fields"
    - "After submitting a ticket, user sees ticket number and status"
    - "My Tickets section shows user's open support tickets with status badges"
    - "User can click a ticket to see its status and any admin responses"
    - "API paths are correct (use /api/users/support/* for stubs)"
  artifacts:
    - path: "kalasetu-frontend/src/components/profile/tabs/HelpSupportTab.jsx"
      provides: "Enhanced help tab with templates and ticket tracking"
      contains: "My Tickets"
  key_links:
    - from: "kalasetu-frontend/src/components/profile/tabs/HelpSupportTab.jsx"
      to: "/api/users/support/contact"
      via: "api.post for creating tickets via stub route"
      pattern: "api\\.post.*users/support"
    - from: "kalasetu-frontend/src/components/profile/tabs/HelpSupportTab.jsx"
      to: "/api/support"
      via: "api.get for listing user's tickets"
      pattern: "api\\.get.*support"
---

<objective>
Redesign HelpSupportTab with category quick-pick cards, pre-filled forms, and a My Tickets section showing open tickets with status tracking.

Purpose: Currently users face a blank form requiring subject, message, and priority. Quick-pick categories reduce friction (1-click to select category, then just describe the issue). My Tickets section lets users track their requests without contacting support again. Also fixes broken API paths (was posting to /api/support/* but stubs are at /api/users/support/*).

Output: Enhanced HelpSupportTab.jsx with category cards, streamlined form, and ticket list.
</objective>

<execution_context>
@C:/Users/Lenovo/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Lenovo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@kalasetu-frontend/src/components/profile/tabs/HelpSupportTab.jsx
@kalasetu-backend/routes/userAuthRoutes.js
@kalasetu-backend/routes/supportRoutes.js
@kalasetu-backend/controllers/supportController.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign HelpSupportTab with category cards, My Tickets, and fix API paths</name>
  <files>
    kalasetu-frontend/src/components/profile/tabs/HelpSupportTab.jsx
  </files>
  <action>
Rewrite `HelpSupportTab.jsx` to replace the blank form approach with a streamlined category-first flow and ticket tracking.

**Overall layout (top to bottom):**
1. Header (keep existing)
2. **My Tickets** section (NEW — shows user's open tickets)
3. **Quick Help** category cards (NEW — replaces blank Contact Support form)
4. **FAQs** (keep existing, move to bottom)
5. **Report an Issue** (keep existing but simplify)
6. **Legal Links** (keep existing)

**IMPORTANT API path fix:**
The current code posts to `/api/support/contact` and `/api/support/report`. These are WRONG — the stubs are at `/api/users/support/contact` and `/api/users/support/report` (on userAuthRoutes mounted at /api/users). Fix both paths.

**1. My Tickets section (new, at top of page):**

Add state: `tickets` (array), `ticketsLoading` (bool), `selectedTicket` (object|null).

Fetch on mount: `GET /api/support` (the new support routes from plan 02-02). This returns the user's tickets with pagination.

Display as a compact list (NOT a full page — just a summary section):
```jsx
<div className="bg-gray-50 dark:bg-gray-800 rounded-lg p-6">
  <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4">
    My Support Tickets
  </h3>
  {ticketsLoading ? (
    <p className="text-sm text-gray-500">Loading tickets...</p>
  ) : tickets.length > 0 ? (
    <div className="space-y-3">
      {tickets.slice(0, 5).map(ticket => (
        <div key={ticket._id}
          onClick={() => setSelectedTicket(selectedTicket?._id === ticket._id ? null : ticket)}
          className="flex items-center justify-between p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 cursor-pointer hover:border-brand-300 transition-colors">
          <div className="flex-1 min-w-0">
            <p className="text-sm font-medium text-gray-900 dark:text-white truncate">{ticket.subject}</p>
            <p className="text-xs text-gray-500">{ticket.ticketNumber} · {new Date(ticket.createdAt).toLocaleDateString()}</p>
          </div>
          <span className={`ml-3 px-2 py-1 rounded text-xs font-medium shrink-0 ${getTicketStatusColor(ticket.status)}`}>
            {ticket.status.replace('_', ' ')}
          </span>
        </div>
      ))}
    </div>
  ) : (
    <p className="text-sm text-gray-500 dark:text-gray-400">No support tickets yet.</p>
  )}
</div>
```

When a ticket is clicked (selectedTicket), show an expanded detail below it:
- Ticket subject, description, status, created date
- If the ticket has been updated (status changed from open), show a message like "Our team is working on this" or "Resolved" depending on status
- Simple view — don't show the full message thread (that's admin-side)

Add `getTicketStatusColor` helper: open=amber, in_progress=blue, resolved=green, closed=gray.

**2. Quick Help category cards (replace blank Contact Support form):**

Replace the "Contact Support" section with category quick-pick cards:

```jsx
<div>
  <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4">
    How can we help?
  </h3>
  <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
    {supportCategories.map(cat => (
      <button key={cat.key} onClick={() => openSupportForm(cat)}
        className={`p-4 rounded-lg border-2 text-left transition-colors ${
          selectedCategory?.key === cat.key
            ? 'border-brand-500 bg-brand-50 dark:bg-brand-900/20'
            : 'border-gray-200 dark:border-gray-600 hover:border-brand-300'
        }`}>
        <cat.icon className="h-6 w-6 text-brand-500 mb-2" />
        <p className="font-medium text-sm text-gray-900 dark:text-white">{cat.label}</p>
        <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">{cat.description}</p>
      </button>
    ))}
  </div>
</div>
```

Define `supportCategories` array:
```javascript
const supportCategories = [
  { key: 'booking', label: 'Booking Issue', description: 'Problems with a booking or appointment', icon: Calendar, subject: 'Booking Issue' },
  { key: 'payment', label: 'Payment Problem', description: 'Payment failed, wrong amount, or charges', icon: CreditCard, subject: 'Payment Issue' },
  { key: 'refund', label: 'Refund Help', description: 'Questions about refunds or returns', icon: RotateCcw, subject: 'Refund Inquiry' },
  { key: 'account', label: 'Account Help', description: 'Login, password, or profile issues', icon: UserIcon, subject: 'Account Issue' },
  { key: 'technical', label: 'Technical Issue', description: 'App errors, bugs, or performance', icon: AlertTriangle, subject: 'Technical Issue' },
  { key: 'other', label: 'Other', description: 'Anything else we can help with', icon: HelpCircle, subject: '' },
];
```

**3. Support form (shown after selecting a category):**

When a category is selected, show a compact form below the cards:

```jsx
{selectedCategory && (
  <div className="bg-gray-50 dark:bg-gray-800 rounded-lg p-6 mt-4">
    <div className="flex items-center justify-between mb-4">
      <h4 className="font-semibold text-gray-900 dark:text-white">
        {selectedCategory.label}
      </h4>
      <button onClick={() => setSelectedCategory(null)} className="text-gray-400 hover:text-gray-600">
        <X className="h-5 w-5" />
      </button>
    </div>

    {/* Subject — pre-filled but editable */}
    <div className="mb-4">
      <label className="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Subject</label>
      <input type="text" value={supportForm.subject}
        onChange={e => setSupportForm(prev => ({ ...prev, subject: e.target.value }))}
        className="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-500 dark:bg-white dark:text-gray-900"
        placeholder="Brief description of your issue" required />
    </div>

    {/* Message */}
    <div className="mb-4">
      <label className="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
        Describe your issue
      </label>
      <textarea value={supportForm.message}
        onChange={e => setSupportForm(prev => ({ ...prev, message: e.target.value }))}
        rows={4} className="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-500 dark:bg-white dark:text-gray-900 resize-none"
        required minLength={20} placeholder={selectedCategory.key === 'booking' ? 'Which booking? What went wrong?' : selectedCategory.key === 'payment' ? 'What payment issue are you facing?' : 'Tell us what happened...'} />
    </div>

    <button type="button" onClick={handleSupportSubmit} disabled={supportLoading || !supportForm.subject || !supportForm.message}
      className="w-full md:w-auto px-6 py-3 bg-brand-500 text-white rounded-lg hover:bg-brand-600 disabled:opacity-50 transition-colors font-medium">
      {supportLoading ? 'Sending...' : 'Send Message'}
    </button>
  </div>
)}
```

**4. handleSupportSubmit:**
- POST to `/api/users/support/contact` (FIXED path) with `{ subject: supportForm.subject, message: supportForm.message, priority: 'medium' }`.
- On success: showToast with ticket number if returned, reset form, close category selection, refetch tickets.
- On error: showToast error message.

**5. Report Issue form:**
- Fix path from `/api/support/report` to `/api/users/support/report`.
- Keep the existing form but it can stay as-is (it's a simpler flow).
- On success: refetch tickets to show the new ticket in My Tickets.

**6. Remove the "Contact Support" email/phone section** — the category cards replace this. Keep the email as a fallback line: "Can't find what you need? Email us at support@kalasetu.com" below the form area.

**7. Use brand-* tokens** instead of hardcoded `#A55233` / `#8e462b`. Replace `text-[#A55233]` with `text-brand-500`, `hover:text-[#8e462b]` with `hover:text-brand-600`, `bg-[#A55233]` with `bg-brand-500`, `focus:ring-[#A55233]` with `focus:ring-brand-500`.

**8. Imports from lucide-react:** Add `Calendar, CreditCard, RotateCcw, User as UserIcon, AlertTriangle, HelpCircle, X, MessageSquare, Clock` (keep only what's used).

**9. State structure:**
```javascript
const [tickets, setTickets] = useState([]);
const [ticketsLoading, setTicketsLoading] = useState(true);
const [selectedTicket, setSelectedTicket] = useState(null);
const [selectedCategory, setSelectedCategory] = useState(null);
const [supportForm, setSupportForm] = useState({ subject: '', message: '' });
const [supportLoading, setSupportLoading] = useState(false);
// Keep existing: expandedFaq, issueReport
```

`openSupportForm(category)`: Sets `selectedCategory = category`, pre-fills `supportForm.subject = category.subject`.
  </action>
  <verify>
Check that HelpSupportTab.jsx:
- Contains "My Support Tickets" section
- Contains `supportCategories` array with 6 categories
- Posts to `/api/users/support/contact` (not `/api/support/contact`)
- Posts to `/api/users/support/report` (not `/api/support/report`)
- Fetches tickets from `GET /api/support`
- Uses `brand-500` instead of `#A55233`
- Has no hardcoded hex color values for brand

Run lint: `cd kalasetu-frontend && npx eslint src/components/profile/tabs/HelpSupportTab.jsx --no-error-on-unmatched-pattern 2>&1 | head -20`
  </verify>
  <done>
HelpSupportTab redesigned with: My Tickets section showing user's open tickets with status badges and expandable details. Category quick-pick cards (Booking, Payment, Refund, Account, Technical, Other) replacing blank form. Pre-filled subject and contextual placeholder text per category. API paths fixed. Brand tokens used consistently.
  </done>
</task>

</tasks>

<verification>
1. My Tickets section shows user's support tickets with status badges
2. Category cards render with icons and descriptions
3. Selecting a category shows pre-filled form
4. Form submits to correct API path (/api/users/support/contact)
5. Issue report submits to correct path (/api/users/support/report)
6. After submission, ticket appears in My Tickets list
7. No hardcoded hex colors — all use brand-* tokens
8. No ESLint errors
</verification>

<success_criteria>
- Category quick-pick cards replace blank form
- Pre-filled subject per category
- My Tickets section with status tracking
- Fixed API paths (was broken)
- Brand tokens used consistently
</success_criteria>

<output>
After completion, create `.planning/phases/02-refund-support/02-06-SUMMARY.md`
</output>
