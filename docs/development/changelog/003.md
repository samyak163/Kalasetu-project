# Changelog 003 — Phase 01: Critical Bug Fixes

> **Date:** 2026-02-13
> **Commits:** 10
> **Range:** 9c13b10...6f43b30

## What Changed

Fixed 4 critical bugs: booking race condition, infinite notification loop, weak auth rate limiting, and silent error swallowing. Added file upload validation. First V2 phase completed.

## Changes

### Backend — Bug Fixes

#### Booking Race Condition Fix (BUG-01)
- **Type:** Bug Fix
- **What:** Wrapped booking creation in MongoDB transaction with `session.startTransaction()`. If two customers try to book the same slot simultaneously, the second transaction aborts
- **Why:** Two customers could book the same artisan at the same time — no concurrency protection existed
- **Files:** `controllers/bookingController.js`

#### Auth Rate Limiting Tightened (BUG-04)
- **Type:** Security
- **What:** Reduced auth rate limits from 100 attempts/15min to stricter limits on login, registration, and OTP endpoints
- **Why:** Rate limiter was too loose — brute force attacks could succeed within the window
- **Files:** Auth route configuration

#### Empty Catch Blocks → Sentry Reporting
- **Type:** Bug Fix
- **What:** Replaced all empty `catch {}` blocks across controllers and utils with Sentry error reporting including context
- **Why:** Errors were silently swallowed — bugs went undetected in production
- **Files:** Multiple controllers and utils

### Backend — Features

#### File Upload Validation
- **Type:** Security
- **What:** Created shared multer middleware with file type validation (images only: jpg, png, webp) and size limits. Applied to artisan profile photo and document upload routes
- **Why:** No validation existed — users could upload any file type or size, including executables
- **Files:** New multer config module, `controllers/artisanProfileController.js`

### Frontend — Bug Fixes

#### NotificationContext Infinite Loop Fix
- **Type:** Bug Fix
- **What:** Added proper dependency array and polling interval to NotificationContext. Was re-fetching notifications on every render
- **Why:** Caused hundreds of API calls per minute per user, degrading server performance
- **Files:** `src/context/NotificationContext.jsx`

### Documentation

#### Phase Planning & Verification
- **Type:** Documentation
- **What:** Research docs, bug analysis plans, and phase completion verification for all 4 fixes
- **Files:** `.planning/` phase-01 documents

## Impact

| Area | Change |
|------|--------|
| Customer | No more double-bookings, faster page loads (no notification spam) |
| Artisan | No more double-bookings on their time slots |
| Admin | Better error visibility via Sentry |
| Developer | File uploads validated, auth hardened, errors tracked |
